{"version":3,"file":"static/js/311.f8a9cff5.chunk.js","mappings":"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","sources":["services/oauthFSLAuth.js"],"sourcesContent":["import { API_CONFIG } from './fslConfig';\r\n\r\n/**\r\n * OAuth-based FSL Authentication Service\r\n * \r\n * Flow:\r\n * 1. OAuth Authentication ‚Üí Get access token\r\n * 2. User Identity Verification ‚Üí Compare with /app/marketUserData\r\n * 3. FSL SDK Payment ‚Üí Use access token for blockchain operations\r\n */\r\nclass OAuthFSLAuthService {\r\n  constructor() {\r\n    this.accessToken = null;\r\n    this.currentUser = null;\r\n    this.fslAuth = null;\r\n    this.isInitialized = false;\r\n    this.isDevelopment = process.env.NODE_ENV === 'development' || window.location.hostname === 'localhost';\r\n    \r\n    // FSL OAuth Configuration\r\n    this.FSL_OAUTH_URL = 'https://9ijsflpfgm3.joysteps.io/api/account/oauth/authorize';\r\n    this.FSL_USER_PROFILE_URL = 'https://9ijsflpfgm3.joysteps.io/api/account/party/user';\r\n    this.APP_KEY = 'MiniGame';\r\n    this.REDIRECT_URI = window.location.origin + window.location.pathname; // Use current web URL\r\n    \r\n\r\n  }\r\n\r\n  /**\r\n   * Phase 1: OAuth Authentication\r\n   * Redirect user to FSL OAuth for authentication\r\n   */\r\n  async authenticateWithOAuth() {\r\n    try {\r\n      console.log('üîÑ Starting OAuth authentication...');\r\n      \r\n      const params = new URLSearchParams({\r\n        response_type: 'token',\r\n        appkey: this.APP_KEY,\r\n        redirect_uri: encodeURIComponent(this.REDIRECT_URI),\r\n        scope: 'basic',\r\n        state: 'test',\r\n      });\r\n      \r\n      const oauthUrl = `${this.FSL_OAUTH_URL}?${params.toString()}`;\r\n      console.log('üîó OAuth URL:', oauthUrl);\r\n      \r\n      // Redirect to FSL OAuth\r\n      window.location.href = oauthUrl;\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå OAuth authentication failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle OAuth callback and extract access token\r\n   * This should be called from the callback page\r\n   */\r\n  handleOAuthCallback() {\r\n    try {\r\n      console.log('üîÑ Handling OAuth callback...');\r\n      \r\n      // Get access token from URL fragment\r\n      const fragment = window.location.hash.substring(1);\r\n      const params = new URLSearchParams(fragment);\r\n      \r\n      this.accessToken = params.get('access_token');\r\n      const state = params.get('state');\r\n      const error = params.get('error');\r\n      \r\n      console.log('üîç OAuth callback params:', { accessToken: !!this.accessToken, state, error });\r\n      \r\n      if (error) {\r\n        throw new Error(`OAuth error: ${error}`);\r\n      }\r\n      \r\n      if (!this.accessToken) {\r\n        throw new Error('No access token received from OAuth');\r\n      }\r\n      \r\n      // Store access token\r\n      localStorage.setItem('fsl_access_token', this.accessToken);\r\n      localStorage.setItem('fsl_oauth_timestamp', Date.now().toString());\r\n      \r\n      console.log('‚úÖ OAuth callback successful, access token stored');\r\n      \r\n      return {\r\n        success: true,\r\n        accessToken: this.accessToken,\r\n        state: state\r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå OAuth callback handling failed:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get stored access token or trigger re-authentication\r\n   */\r\n  async getAccessToken() {\r\n    try {\r\n      // Check if we have a valid access token\r\n      const storedToken = localStorage.getItem('fsl_access_token');\r\n      const timestamp = localStorage.getItem('fsl_oauth_timestamp');\r\n      \r\n      if (storedToken && timestamp) {\r\n        const tokenAge = Date.now() - parseInt(timestamp);\r\n        const tokenLifetime = 24 * 60 * 60 * 1000; // 24 hours in milliseconds\r\n        \r\n        if (tokenAge < tokenLifetime) {\r\n          this.accessToken = storedToken;\r\n          console.log('‚úÖ Using stored access token');\r\n          return this.accessToken;\r\n        } else {\r\n          console.log('‚ö†Ô∏è Access token expired, clearing...');\r\n          this.clearStoredTokens();\r\n        }\r\n      }\r\n      \r\n      // No valid token, need to authenticate\r\n      console.log('üîÑ No valid access token, redirecting to OAuth...');\r\n      await this.authenticateWithOAuth();\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Failed to get access token:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear stored OAuth tokens\r\n   */\r\n  clearStoredTokens() {\r\n    localStorage.removeItem('fsl_access_token');\r\n    localStorage.removeItem('fsl_oauth_timestamp');\r\n    this.accessToken = null;\r\n    console.log('üóëÔ∏è Stored tokens cleared');\r\n  }\r\n\r\n  /**\r\n   * Phase 2: User Identity Verification\r\n   * Get user profile from FSL API and verify with /app/marketUserData\r\n   */\r\n  async verifyUserIdentity() {\r\n    try {\r\n      console.log('üîç Verifying user identity...');\r\n      \r\n      if (!this.accessToken) {\r\n        throw new Error('No access token available');\r\n      }\r\n\r\n      // Get user profile from FSL API\r\n      const fslUserProfile = await this.getFSLUserProfile();\r\n      console.log('üìä FSL User Profile:', fslUserProfile);\r\n      \r\n      // Get market user data from your API\r\n      const marketUserData = await this.getMarketUserData();\r\n      console.log('üìä Market User Data:', marketUserData);\r\n      \r\n      // Compare FSL IDs\r\n      const fslId = fslUserProfile.data?.fslUid || fslUserProfile.data?.uid;\r\n      const marketFSLId = marketUserData.fslId;\r\n      \r\n      console.log('üîç Comparing FSL IDs:');\r\n      console.log('  FSL API FSL ID:', fslId);\r\n      console.log('  Market API FSL ID:', marketFSLId);\r\n      \r\n      if (!fslId || !marketFSLId) {\r\n        throw new Error('Missing FSL ID from one or both sources');\r\n      }\r\n      \r\n      const isMatch = fslId.toString() === marketFSLId.toString();\r\n      console.log('‚úÖ FSL ID match:', isMatch);\r\n      \r\n      if (isMatch) {\r\n        // Store verified user data\r\n        this.currentUser = {\r\n          fslId: fslId,\r\n          fslProfile: fslUserProfile.data,\r\n          marketProfile: marketUserData,\r\n          isVerified: true,\r\n          verifiedAt: new Date().toISOString()\r\n        };\r\n        \r\n        console.log('‚úÖ User identity verified:', this.currentUser);\r\n        return {\r\n          success: true,\r\n          user: this.currentUser,\r\n          fslId: fslId\r\n        };\r\n      } else {\r\n        throw new Error('FSL ID mismatch. User may be logged into different account.');\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå User identity verification failed:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get user profile from FSL API using access token\r\n   */\r\n  async getFSLUserProfile() {\r\n    try {\r\n      console.log('üì° Getting FSL user profile...');\r\n      \r\n      const response = await fetch(this.FSL_USER_PROFILE_URL, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${this.accessToken}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`FSL API error: ${response.status} ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      console.log('‚úÖ FSL user profile received:', data);\r\n      \r\n      return data;\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Failed to get FSL user profile:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get market user data from your API\r\n   */\r\n  async getMarketUserData() {\r\n    try {\r\n      console.log('üì° Getting market user data...');\r\n      \r\n      // This should call your existing /app/marketUserData API\r\n      // You'll need to implement this based on your current implementation\r\n      const response = await fetch(`${API_CONFIG.server_url}/api/app/marketUserData`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          // Add any required headers (auth tokens, etc.)\r\n        }\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Market API error: ${response.status} ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      console.log('‚úÖ Market user data received:', data);\r\n      \r\n      return data;\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Failed to get market user data:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  /**\r\n   * Check if user is authenticated and verified\r\n   */\r\n  isUserAuthenticated() {\r\n    return !!(this.accessToken && this.currentUser?.isVerified);\r\n  }\r\n\r\n  /**\r\n   * Get current user info\r\n   */\r\n  getCurrentUser() {\r\n    return this.currentUser;\r\n  }\r\n\r\n  /**\r\n   * Get access token for FSL SDK to use\r\n   */\r\n  getAccessTokenForFSL() {\r\n    return this.accessToken;\r\n  }\r\n\r\n  /**\r\n   * Logout and clear all data\r\n   */\r\n  logout() {\r\n    this.clearStoredTokens();\r\n    this.currentUser = null;\r\n    this.fslAuth = null;\r\n    this.isInitialized = false;\r\n    console.log('‚úÖ User logged out successfully');\r\n  }\r\n}\r\n\r\nconst oauthFSLAuthService = new OAuthFSLAuthService();\r\nexport default oauthFSLAuthService;\r\n"],"names":["constructor","this","accessToken","currentUser","fslAuth","isInitialized","isDevelopment","window","location","hostname","FSL_OAUTH_URL","FSL_USER_PROFILE_URL","APP_KEY","REDIRECT_URI","origin","pathname","authenticateWithOAuth","console","log","params","URLSearchParams","response_type","appkey","redirect_uri","encodeURIComponent","scope","state","oauthUrl","toString","href","error","handleOAuthCallback","fragment","hash","substring","get","Error","localStorage","setItem","Date","now","success","message","getAccessToken","storedToken","getItem","timestamp","tokenAge","parseInt","clearStoredTokens","removeItem","verifyUserIdentity","_fslUserProfile$data","_fslUserProfile$data2","fslUserProfile","getFSLUserProfile","marketUserData","getMarketUserData","fslId","data","fslUid","uid","marketFSLId","isMatch","fslProfile","marketProfile","isVerified","verifiedAt","toISOString","user","response","fetch","method","headers","ok","status","statusText","json","API_CONFIG","server_url","isUserAuthenticated","_this$currentUser","getCurrentUser","getAccessTokenForFSL","logout"],"sourceRoot":""}